---
title: "11.데이터시각화-ggplot2"
author: "Bongus"
date: '2018 8 8 '
output: html_document
---

## 데이터 시각화 with ggplot2
데이터를 시각화 한 것을 (보통)그래프라고 합니다. 데이터를 시각화하면 전체 특징을 한 눈에 파악할 수 있고, 데이터의 추세, 경향성, 패턴을 파악할 수 있습니다. R은 강력한 시각화 기능을 가지고 있습니다. 2차원 그래프, 3차원 그래프, 지도그래프, 네트워크 그래프, 시간에따라 변하는 그래프 등 다양한 그래프를 그릴 수 있는 패키지가 있습니다. 그 중 가장 많이 사용하는 패키지는 ggplot2라는 패키지입니다. dplyr을 만든 hadley wickham 교수가 만든 패키지입니다. ggplot2를 사용하면 쉽게 시각적으로 예쁜 그래프를 그릴 수 있습니다. 


### ggplot2 
![](./ggplot.JPG)
ggplot2의 레이어 구조로 되어있습니다. 먼저 배경을 만들고, 그 위에 데이터 형태를 그립니다. 데이터 형태가 그려지면 그 위에 축 범위, 색, 범례 등 설정을 추가하는 방식으로 그래를 그립니다. 
  
### 1.산점도
```{R}
#install.package('ggplot2')
library(ggplot2)
# ggplot패키지 안에는 연습용 데이터셋인 mpg 데이터가 있습니다. 
head(mpg, 5)
```

먼저 그래프를 그릴 배경을 만들어야 합니다. ggplot에 data를 그릴 데이터를 지정하고, aes에 x축, y축에 사용할 변수를 지정하면 그래프의 배경이 그려집니다(주의할 점은 R은 데이터가 들어간대로 그래프를 그려줍니다. 시각화를 할 데이터의 특징을 미리 파악하고 있어야 '데이터에 맞는 올바른' 그래프를 그릴 수 있습니다). 여기서 data는 주로 data.frame이 사용되고, x, y축에 들어갈 변수는 data안에 있는 **변수 이름**을 넣으면 됩니다. 
```{R}
# 그래프 배경 생성
ggplot(data=mpg, aes(x = displ, y=hwy))
```
  
그래프 배경이 생성되었으면 그래프의 형태를 그리는 작업을 해야합니다. 그래프의 형태는 ggplot내부의 함수로 만들어져 있고,  **+**기호를 통해 그래프 배경에 이어 붙이면 됩니다. 산점도는 `geom_point()`라는 함수로 그릴 수 있습니다. 
```{R}
# 그래프 형태 추가
ggplot(data=mpg, aes(x = displ, y=hwy)) + geom_point()
```
코드를 실행하면 배경 위에 데이터가 점으로 표현된 산점도가 만들어집니다. 산점도에 표시된 점들은 각각의 관측치를 의미합니다. 형태가 만들어지면 그 위에 기타 그래프에 대한 설명을 표현할 수 있습니다. xlim(), ylim()을 사용하면 그래프의 범위를 조절할 수 있습니다.
```{R}
# 그래프 설명 추가
# x축은 3~6, y축은 10~50
ggplot(data=mpg, aes(x = displ, y=hwy)) + geom_point() + xlim(3, 6) + ylim(10, 50)
```
ggplot은 레이어 구조라는게 이해가 되시나요? 먼저 배경을 만들고 그 위에 데이터를 하나씩 쌓아가면서 그래프를 만든다고 생각하면 됩니다.  

### 2. 막대그래프 - 집단 간 차이 표현
막대그래프는 데이터의 크기를 막대의 길이로 표현할 그래프입니다. 주로 범주, 집단으로 이루어진 데이터를 비교할 때 사용합니다. 가장 많이 사용되는 막대그래프는 각 집단의 평균값을 막대 그래프로 표현하는 것입니다. mpg데이터를 사용해서 집단의 평균값을 막대그래프로 그려보도록 하겠습니다. 먼저 dplyr을 이용해 집단별 평균을 데이터 프레임으로 만들고, 그 데이터 프래임을 ggplot에 넣어서 사용합니다. x축에는 범주를 나타낼 변수를 지정하고, y축에는 평균값을 나타내는 변수를 지정합니다. 그리고 **+**기호를 사용해 막대그래를 만드는 geom_col()함수를 사용하면 막대그래프가 만들어집니다. 
```{R}
library(dplyr)
mean_mpg <- mpg %>%
  group_by(drv) %>%
  summarise(mean = mean(hwy))
mean_mpg

ggplot(data=mean_mpg, aes(x=drv, y=mean)) + geom_col()
```
빈도수를 가지고도 막대그래프를 그릴 수 있는데 그것을 빈도 막대 그래프라고 합니다. 빈도 막대 그래프를 그리기 위해선 x축을 지정하고, geom_bar()함수를 사용하면 됩니다. 
```{R}
ggplot(data=mpg, aes(x=drv)) + geom_bar()
```
x축에 연속형 데이터를 사용하면 데이터의 분포를 파악할 수 있습니다. 
```{R}
ggplot(data=mpg, aes(x=hwy)) + geom_bar()
```

#### geom_col() vs geom_bar()
평균 막대 그래프는 데이터를 요약한 평균표를 먼저 만든 후 이 평균표를 이용해 만듭니다. 반면 빈도 막대 그래프는 별도의 표룰 만들지 않고 원자료를 이용해 바로 만듭니다. 요약표를 이용하는지, 원자료를 이용하지는지에 따라 그래프를 만드는 절차와 함수가 다릅니다. 요약표는 geom_col() 원자료는 geom_bar()를 사용합니다.  중요한 것은 데이터에 대한 이해가 먼저 선행되어야 합니다. 

### 3. 선(line) 그래프 - 시계열 데이터 표현하기
데이터를 선(line)으로 표현한 그래프를 선(line)그래프라고 합니다. 시간에 따라 달라지는 데이터를 표현할 때 주로 선그래프를 이용하는데 환율, 주가지수 등 경제 지표가 시간에 따라 어떻게 변하는지를 선 그래프로 표현할 수 있습니다. 일별 환율처럼 일정 시간 간격을 두고 나열된 데이터를 **시계열데이터(Time Series Data)**라고 하고, 이러한 시계열 데이터는 선 그래프로 표현하기 좋습니다. 
  
ggplot의 economics라는 데이터셋을 이용해 시계열 그래프를 그려보겠습니다. economics데이터는 미국 경제 지표들을 월별로 나타낸 그래프입니다. 이번 실습에서 시간에 따라 실업자의 수가 어떻게 변하는지 알아보도록 하겠습니다. 
```{R}
ggplot(data = economics, aes(x = date, y = unemploy)) + geom_line()
```
최근 미국은 2010년 이후로 실업률이 줄어들고 잇음을 파악할 수 있습니다. 
  
### 4. 박스(box) 그래프 - 집단 간 분포 차이 표현하기
박스(box) 그래프는 데이터의 분포를 직사각형 상자로 표현한 그래프입니다. 특히 집단간 데이터가 어떻게 분포되어있는지 비교하는데 좋고, 평균만 볼 때보다 데이터의 특징을 더 자세히 이해할 수 있습니다. geom_boxplot()을 통해 그릴 수 있으며 방법은 앞에서 했던 방법들과 동일합니다(R에서는 기본적으로 boxplot() 함수를 제공합니다. 간단하게 확인하고 싶을 떄는 boxplot()함수를 사용하는 것도 좋은 방법입니다).
```{R}
ggplot(data=mpg, aes(x = drv, y = hwy)) + geom_boxplot()
```
  
지금까지 ggplot의 기능들을 간단히 알아보았습니다. ggplot은 굉장히 큰 패키지이므로 모든 것을 외우는 것을 불가능합니다. 몇몇 기본적인 기능에 익숙해지고, 그 다음에는 검색을 통해 필요한 기능을 찾아봐야 합니다. 찾다보면 ggplot의 엄청나 기능에 반하게 될 것입니다. 

  
---
